# Architecture DevOps E-commerce Microservices

[![Infrastructure](https://img.shields.io/badge/Infrastructure-Terraform-623CE4)](https://www.terraform.io/)
[![CI/CD](https://img.shields.io/badge/CI%2FCD-GitLab-FC6D26)](https://about.gitlab.com/)
[![Orchestration](https://img.shields.io/badge/Orchestration-Kubernetes-326CE5)](https://kubernetes.io/)
[![GitOps](https://img.shields.io/badge/GitOps-ArgoCD-EF7B4D)](https://argo-cd.readthedocs.io/)
[![Monitoring](https://img.shields.io/badge/Monitoring-Prometheus%2FGrafana-E6522C)](https://prometheus.io/)

## üìã Vue d'ensemble du projet

Ce projet impl√©mente une architecture DevOps compl√®te pour une application e-commerce bas√©e sur des microservices. L'architecture est organis√©e en trois parties distinctes, chacune avec un r√¥le sp√©cifique dans le cycle de vie de l'application:

1. **[/ecommerce_app](/ecommerce_app)** - Code source de l'application et pipelines CI
2. **[/ecommerce_iac](/ecommerce_iac)** - Infrastructure as Code et automation
3. **[/prod_manifeste](/prod_manifeste)** - Manifestes Kubernetes pour le d√©ploiement GitOps

Cette approche modulaire permet une s√©paration claire des responsabilit√©s et facilite la maintenance et l'√©volution de chaque composant.

## üèóÔ∏è Architecture globale

```
üìÇ ecommerce-project
‚î£‚îÅ‚îÅ üìÇ ecommerce_app          # Code source et CI
‚îÉ    ‚î£‚îÅ‚îÅ üìÇ frontend          # Application React
‚îÉ    ‚î£‚îÅ‚îÅ üìÇ microservices     # Services backend
‚îÉ    ‚îó‚îÅ‚îÅ üìÇ .gitlab-ci.yml    # Pipeline CI/CD
‚îÉ
‚î£‚îÅ‚îÅ üìÇ ecommerce_iac          # Infrastructure as Code
‚îÉ    ‚î£‚îÅ‚îÅ üìÇ terraform         # Modules Terraform AWS
‚îÉ    ‚î£‚îÅ‚îÅ üìÇ scripts           # Scripts d'automatisation
‚îÉ    ‚îó‚îÅ‚îÅ üìÇ .gitlab-ci.yml    # Pipeline IaC
‚îÉ
‚îó‚îÅ‚îÅ üìÇ prod_manifeste         # Manifestes de production
     ‚î£‚îÅ‚îÅ üìÇ charts            # Charts Helm
     ‚î£‚îÅ‚îÅ üìÇ values            # Fichiers de valeurs
     ‚îó‚îÅ‚îÅ üìÇ argocd            # Configurations ArgoCD
```

### Flux de travail entre les composants

```mermaid
graph TD
    subgraph "ecommerce_app"
        A[Code Source Frontend/Backend] --> B[Pipeline CI]
        B --> C[Build & Test]
        C --> D[Image Docker]
        D --> E[Registry GitLab]
    end

    subgraph "ecommerce_iac"
        F[Terraform Modules] --> G[Pipeline IaC]
        G --> H[AWS Resources]
        H --> I[EKS Cluster]
        I --> J[Addons Kubernetes]
    end

    subgraph "prod_manifeste"
        K[Helm Charts] --> L[Values Production]
        L --> M[ArgoCD Applications]
    end

    E --> K
    J --> M
    M --> N[D√©ploiement Production]
```

## üì¶ Description des composants

### 1. ecommerce_app

Ce module contient le code source de l'application e-commerce microservices et les pipelines CI pour la construction et les tests.

**Contenu principal:**
- Code source frontend React
- Microservices backend (Customers, Products, Shopping)
- Dockerfiles optimis√©s
- Pipeline GitLab CI pour le build, les tests et la s√©curit√©
- Chart Helm pour les environnements de d√©veloppement et staging

**Technologies cl√©s:**
- React (Frontend)
- Node.js (Backend)
- MongoDB
- RabbitMQ
- Docker
- Helm

[Voir le dossier ecommerce_app ‚Üí](/ecommerce_app)

### 2. ecommerce_iac

Ce module contient toute l'infrastructure as code (IaC) n√©cessaire pour provisionner et maintenir l'environnement cloud.

**Contenu principal:**
- Modules Terraform pour AWS
- Pipeline GitLab CI pour l'automatisation de l'infrastructure
- Scripts de configuration et d'initialisation
- Manifestes Kubernetes pour les composants d'infrastructure

**Modules Terraform:**
- **VPC & R√©seau**: Subnets, Internet Gateway, NAT Gateway
- **EKS**: Cluster Kubernetes, groupes de n≈ìuds, IRSA
- **IAM**: R√¥les et politiques pour les services AWS
- **S3**: Buckets pour les backups, logs et √©tats Terraform
- **Helm**: Charts pour les composants d'infrastructure

**Composants d√©ploy√©s via Helm:**
- NGINX Ingress Controller
- Cert-Manager
- Prometheus & Grafana
- Velero (Backups)
- Fluentd (Logging)
- ArgoCD

[Voir le dossier ecommerce_iac ‚Üí](/ecommerce_iac)

### 3. prod_manifeste

Ce module contient les manifestes Kubernetes et les configurations pour le d√©ploiement en production via GitOps.

**Contenu principal:**
- Charts Helm pour l'application et les services
- Fichiers de valeurs sp√©cifiques √† la production
- Configurations ArgoCD
- Manifestes de s√©curit√© (NetworkPolicies, RBAC, etc.)

**Particularit√©s:**
- Ce composant est la source de v√©rit√© pour l'√©tat de production
- ArgoCD synchronise automatiquement les changements avec le cluster
- Les modifications suivent un workflow GitOps strict avec approbations

[Voir le dossier prod_manifeste ‚Üí](/prod_manifeste)

## üîÑ Flux CI/CD et GitOps

Le syst√®me utilise deux pipelines principaux:

### Pipeline Application (ecommerce_app)

```mermaid
graph LR
    A[Code Push] --> B[Security Check]
    B --> C[Build & Test]
    C --> D[Build Image]
    D --> E[Push to Registry]
    E --> F[Deploy to Dev/Staging]
    F --> G[Manual Approval]
    G --> H[Update prod_manifeste]
```

### Pipeline Infrastructure (ecommerce_iac)

```mermaid
graph LR
    A[IaC Push] --> B[Terraform Validate]
    B --> C[Security Scan]
    C --> D[Plan Infrastructure]
    D --> E[Manual Approval]
    E --> F[Apply Infrastructure]
    F --> G[Configure Kubernetes]
```

### Workflow GitOps (prod_manifeste)

1. La mise √† jour du dossier `prod_manifeste` est d√©clench√©e par:
   - Approbation manuelle apr√®s tests en staging
   - Modifications d'infrastructure n√©cessitant des changements en production

2. ArgoCD d√©tecte les changements et:
   - Compare l'√©tat souhait√© (Git) avec l'√©tat actuel (Cluster)
   - Planifie et ex√©cute la synchronisation
   - Applique les changements dans le cluster de production

## üîí S√©curit√© et bonnes pratiques

- **Gestion des secrets**: SealedSecrets pour chiffrer les secrets dans Git
- **Infrastructure s√©curis√©e**: VPC priv√©, configurations restrictives du groupe de s√©curit√©
- **IAM**: Principe du moindre privil√®ge avec IRSA (IAM Roles for Service Accounts)
- **CI/CD s√©curis√©e**: Scan des images Docker, validation des manifestes Kubernetes
- **Observabilit√©**: Monitoring avec Prometheus/Grafana, centralisation des logs avec Fluentd
- **Backups**: Sauvegardes automatis√©es avec Velero vers S3

## üìä Monitoring et Observabilit√©

L'infrastructure inclut un stack complet de monitoring:

- **M√©triques**: Prometheus pour la collecte de m√©triques
- **Visualisation**: Dashboards Grafana pour le monitoring en temps r√©el
- **Alertes**: Configuration Alertmanager pour les notifications
- **Logs**: Centralisation des logs avec Fluentd vers S3
- **Tra√ßabilit√©**: Int√©gration potentielle avec OpenTelemetry (en cours)

## üõ†Ô∏è Guide de d√©veloppement

### Pr√©requis

- Docker et Docker Compose
- Terraform 1.0+
- kubectl et Helm
- Acc√®s AWS (pour l'infrastructure compl√®te)
- GitLab CLI (facultatif)

### Workflow de d√©veloppement

1. **Cloner le d√©p√¥t**:
   ```bash
   git clone https://github.com/yourusername/ecommerce-project.git
   cd ecommerce-project
   ```

2. **D√©marrer l'environnement local**:
   ```bash
   cd ecommerce_app
   docker-compose up -d
   ```

3. **D√©velopper et tester localement**:
   - Modifier le code dans `ecommerce_app`
   - Ex√©cuter les tests unitaires et d'int√©gration
   - V√©rifier les changements en local

4. **Pipeline CI**:
   - Pousser les changements pour d√©clencher le pipeline GitLab CI
   - V√©rifier les r√©sultats du pipeline (tests, builds, scan)

5. **D√©ploiement en d√©veloppement/staging**:
   - Le pipeline d√©ploie automatiquement dans les environnements non-production
   - Tester les changements dans ces environnements

6. **Promotion en production**:
   - Approuver la promotion en production
   - Le pipeline met √† jour les fichiers dans `prod_manifeste`
   - ArgoCD synchronise les changements avec le cluster de production

## üöÄ Environnements de d√©ploiement

Le projet supporte trois environnements distincts:

### D√©veloppement
- **H√©bergement**: VM locale avec K3s
- **Objectif**: D√©veloppement rapide et tests
- **D√©ploiement**: Automatique via pipeline CI
- **Configuration**: `values-dev.yaml`

### Staging
- **H√©bergement**: VM locale avec K3s (namespace isol√©)
- **Objectif**: Tests d'int√©gration et validation
- **D√©ploiement**: Automatique apr√®s succ√®s en d√©veloppement
- **Configuration**: `values-staging.yaml`

### Production
- **H√©bergement**: AWS EKS
- **Objectif**: Environnement client final
- **D√©ploiement**: GitOps avec ArgoCD apr√®s approbation manuelle
- **Configuration**: `values-prod.yaml`

## üå± Perspectives d'√©volution

- Impl√©mentation de d√©ploiements Canary/Blue-Green avec Argo Rollouts
- Int√©gration d'une solution de mesh service (Istio ou Linkerd)
- Expansion des tests automatis√©s (tests de charge, tests E2E)
- Mise en place d'une strat√©gie de disaster recovery compl√®te
- Migration vers une architecture event-driven plus compl√®te

## üìö Documentation additionnelle

- [Guide d'architecture d√©taill√©](/docs/architecture.md)
- [Manuel des op√©rations](/docs/operations.md)
- [Proc√©dures de d√©ploiement](/docs/deployment.md)
- [Guide de r√©solution des probl√®mes](/docs/troubleshooting.md)

## üë• Contribution

Les contributions sont les bienvenues! Veuillez consulter nos [guidelines de contribution](./CONTRIBUTING.md) avant de soumettre une Pull Request.

## üìÑ Licence

Ce projet est sous licence [MIT](./LICENSE).